<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Flappy — Fullscreen</title>
  <style>
    html,body{height:100%;margin:0;background:#000}
    canvas{display:block;width:100vw;height:100vh}
    /* hide scrollbars on mobile */
    body{overflow:hidden}
  </style>
</head>
<body>
  <canvas id="game"></canvas>

<script>
// Fullscreen Flappy — developer bundled assets, no UI text
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
let W=0,H=0;

// gameplay settings
const gravityInput = { value: 0.6 };
const jumpInput = { value: 5 };
const gapInput = { value: 150 };

// assets
let birdImg=null, pipeImg=null, bgImg=null, music=null;

function loadImage(url){ return new Promise(res=>{ const img=new Image(); img.onload=()=>res(img); img.onerror=()=>res(null); img.src=url; }); }

async function loadBundled(){
  birdImg = await loadImage('assets/bird.png') || await loadImage('assets/bird.jpg');
  pipeImg = await loadImage('assets/pipe.png') || await loadImage('assets/pipe.jpg');
  bgImg = await loadImage('assets/bg.jpg') || await loadImage('assets/bg.png');
  try{ music = new Audio(); music.src = 'assets/music.mp3'; music.loop=true; music.preload='auto'; music.volume = 0.5; }catch(e){ music=null; }
  if(birdImg){ bird.w = Math.min(80, birdImg.width*0.22 + 20); bird.h = Math.min(60, birdImg.height*0.22 + 20); }
}

function resize(){ const dpr = window.devicePixelRatio || 1; W = Math.max(320, Math.floor(window.innerWidth)); H = Math.max(240, Math.floor(window.innerHeight)); canvas.width = Math.floor(W * dpr); canvas.height = Math.floor(H * dpr); canvas.style.width = W + 'px'; canvas.style.height = H + 'px'; ctx.setTransform(dpr,0,0,dpr,0,0); }
window.addEventListener('resize', resize);

// game state
let playing=false, paused=false;
let bird={x:150,y:300,vy:0,w:40,h:30,angle:0};
let pipes=[]; let frame=0; let score=0; let best=0;

function reset(){ bird={x:150,y:H/2,vy:0,w:bird.w||40,h:bird.h||30,angle:0}; pipes=[]; frame=0; score=0; playing=true; paused=false; if(music){ try{ music.currentTime=0; music.play().catch(()=>{}); }catch(e){} } }

function spawnPipe(){ const gap = parseInt(gapInput.value,10); const min=80, max=H-200; const top = Math.floor(Math.random()*(max-min))+min; pipes.push({x:W, top, width:80, passed:false}); }
function rectOverlap(a,b){ return !(a.r < b.l || a.l > b.r || a.b < b.t || a.t > b.b); }
function die(){ playing=false; if(music) try{ music.pause(); }catch(e){} }

function update(){ if(!playing || paused) return; frame++; const g = parseFloat(gravityInput.value); bird.vy += g; bird.y += bird.vy; bird.angle = Math.max(-0.6, Math.min(0.9, bird.vy/10)); if(frame % 100 === 0) spawnPipe(); for(let i = pipes.length-1; i>=0; i--){ pipes[i].x -= 3 + Math.floor(frame/1000); const p = pipes[i]; const gap = parseInt(gapInput.value,10); if(!p.passed && p.x + p.width < bird.x){ p.passed = true; score++; if(score>best) best=score; } if(p.x + p.width < -50) pipes.splice(i,1); const birdBox={l:bird.x - bird.w/2, r:bird.x + bird.w/2, t:bird.y - bird.h/2, b:bird.y + bird.h/2}; const topBox={l:p.x, r:p.x+p.width, t:0, b:p.top}; const bottomBox={l:p.x, r:p.x+p.width, t:p.top+gap, b:H}; if(rectOverlap(birdBox, topBox) || rectOverlap(birdBox, bottomBox)){ die(); } }
  if(bird.y + bird.h/2 >= H-80) die(); if(bird.y - bird.h/2 <= 0){ bird.y = bird.h/2; bird.vy = 0; }
}

function draw(){ // background
  if(bgImg){ ctx.drawImage(bgImg, 0, 0, bgImg.width, bgImg.height, 0, 0, W, H); } else { ctx.fillStyle='#87CEEB'; ctx.fillRect(0,0,W,H); }
  // pipes
  for(const p of pipes){ const gap = parseInt(gapInput.value,10); const pipeW = p.width; if(pipeImg){ ctx.save(); ctx.translate(p.x + pipeW/2, p.top); ctx.scale(1,-1); ctx.drawImage(pipeImg, -pipeW/2, 0, pipeW, p.top); ctx.restore(); ctx.drawImage(pipeImg, p.x, p.top+gap, pipeW, H - (p.top+gap) - 80); } else { ctx.fillStyle='#2F855A'; ctx.fillRect(p.x, 0, pipeW, p.top); ctx.fillRect(p.x, p.top+gap, pipeW, H-(p.top+gap)-80); } }
  // ground
  ctx.fillStyle='#5C8A00'; ctx.fillRect(0,H-80,W,80);
  // bird
  ctx.save(); ctx.translate(bird.x, bird.y); ctx.rotate(bird.angle); if(birdImg){ ctx.drawImage(birdImg, -bird.w/2, -bird.h/2, bird.w, bird.h); } else { ctx.fillStyle='#FFCC00'; ctx.beginPath(); ctx.ellipse(0,0,bird.w/2,bird.h/2,0,0,Math.PI*2); ctx.fill(); } ctx.restore();
}

function loop(){ update(); draw(); requestAnimationFrame(loop); }

function userFlap(){ if(!playing) { reset(); return; } bird.vy = -parseFloat(jumpInput.value); if(music && music.paused){ try{ music.play().catch(()=>{}); }catch(e){} } }

// input
window.addEventListener('keydown', e=>{ if(e.code==='Space'){ e.preventDefault(); userFlap(); } });
canvas.addEventListener('mousedown', ()=>userFlap());
canvas.addEventListener('touchstart', e=>{ e.preventDefault(); userFlap(); }, {passive:false});

// start
resize();
loadBundled().then(()=>{ loop(); });

</script>
</body>
</html>
